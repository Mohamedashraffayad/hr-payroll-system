
<!DOCTYPE html>
<html>
<head>
<title>HR System</title>
<style>
body { margin:0; font-family:Arial; display:flex; }
.sidebar {
    width:250px;
    background:#1e293b;
    color:white;
    transition:0.3s;
    padding:20px;
}
.sidebar.collapsed { width:70px; }
.main { flex:1; padding:20px; }
button { padding:8px 12px; margin:5px 0; }
.hidden { display:none; }
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
<button onclick="toggleSidebar()">â˜°</button>
<h3>HR System</h3>
<div id="adminMenu" class="hidden">
<button onclick="loadAllLeaves()">All Leave Requests</button>
</div>
<div id="employeeMenu" class="hidden">
<button onclick="showLeaveForm()">Request Leave</button>
</div>
<button onclick="logout()">Logout</button>
</div>

<div class="main">
<div id="loginPage">
<h2>Login</h2>
<input id="username" placeholder="Username"><br>
<input id="password" type="password" placeholder="Password"><br>
<button onclick="login()">Login</button>
</div>

<div id="dashboard" class="hidden">
<h2>Dashboard</h2>
<div id="content"></div>
</div>
</div>

<script>
let token = null;
let role = null;

function toggleSidebar(){
    document.getElementById("sidebar").classList.toggle("collapsed");
}

async function login(){
    const res = await fetch("http://localhost:5000/login",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            username:document.getElementById("username").value,
            password:document.getElementById("password").value
        })
    });

    if(res.status===200){
        const data = await res.json();
        token = data.access_token;

        const payload = JSON.parse(atob(token.split('.')[1]));
        role = payload.sub.role;

        document.getElementById("loginPage").classList.add("hidden");
        document.getElementById("dashboard").classList.remove("hidden");

        if(role==="admin"){
            document.getElementById("adminMenu").classList.remove("hidden");
        }else{
            document.getElementById("employeeMenu").classList.remove("hidden");
        }
    }else{
        alert("Login failed");
    }
}

function logout(){
    location.reload();
}

function showLeaveForm(){
    document.getElementById("content").innerHTML=`
    <h3>Request Leave</h3>
    <input id="start" type="date"><br>
    <input id="end" type="date"><br>
    <input id="reason" placeholder="Reason"><br>
    <button onclick="submitLeave()">Submit</button>
    `;
}

async function submitLeave(){
    await fetch("http://localhost:5000/leave/request",{
        method:"POST",
        headers:{
            "Content-Type":"application/json",
            "Authorization":"Bearer "+token
        },
        body:JSON.stringify({
            start_date:document.getElementById("start").value,
            end_date:document.getElementById("end").value,
            reason:document.getElementById("reason").value
        })
    });
    alert("Request submitted");
}

async function loadAllLeaves(){
    const res = await fetch("http://localhost:5000/leave/all",{
        headers:{ "Authorization":"Bearer "+token }
    });
    const data = await res.json();

    let html="<h3>All Leave Requests</h3>";
    data.forEach(l=>{
        html+=`<div>
        Employee ${l.employee_id} | ${l.start_date} - ${l.end_date} | ${l.status}
        <button onclick="updateLeave(${l.id},'approved')">Approve</button>
        <button onclick="updateLeave(${l.id},'rejected')">Reject</button>
        </div>`;
    });

    document.getElementById("content").innerHTML=html;
}

async function updateLeave(id,status){
    await fetch("http://localhost:5000/leave/update/"+id,{
        method:"PUT",
        headers:{
            "Content-Type":"application/json",
            "Authorization":"Bearer "+token
        },
        body:JSON.stringify({status:status})
    });
    loadAllLeaves();
}
</script>
</body>
</html>
